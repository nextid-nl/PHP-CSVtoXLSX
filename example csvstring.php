<?
@apache_setenv('no-gzip', 1);
include("xlsx.php");

/*settings*/
$filetplpath = "test.xlsx";
$fileexportname = "testexport.xlsx";
$csvpath1 = <<<EOT
1388,110150,201101,8000
1400,120150,201101,3750
1412,142100,201101,2600
1424,242100,201101,9520
1436,242500,201101,712.5
1448,286100,201101,4462.5
1460,286200,201101,4120
1389,110150,201102,19000
1401,120150,201102,11350
1413,142100,201102,5200
1425,242100,201102,22610
1437,242500,201102,2156.5
1449,286100,201102,13506.5
1461,286200,201102,8810
1390,110150,201103,29000
1402,120150,201103,17450
1414,142100,201103,7800
1426,242100,201103,34510
1438,242500,201103,3315.5
1450,286100,201103,20765.5
1462,286200,201103,13310
1391,110150,201104,35500
1403,120150,201104,22050
1415,142100,201104,10400
1427,242100,201104,42245
1439,242500,201104,4189.5
1451,286100,201104,26239.5
1463,286200,201104,17145
1392,110150,201105,41000
1404,120150,201105,24350
1416,142100,201105,15650
1428,242100,201105,48790
1440,242500,201105,4626.5
1452,286100,201105,28976.5
1464,286200,201105,23440
1393,110150,201106,47500
1405,120150,201106,26550
1417,142100,201106,18250
1429,242100,201106,56525
1441,242500,201106,5044.5
1453,286100,201106,31594.5
1465,286200,201106,27275
EOT;
$csvtosheet = "csvdata";
$csvtocol = "A";
$csvtorow = "2";
$csvdelimiter = ",";
$csvenclosure = '"';

/*create temp xlsx file*/
$tmppath=tempnam('php://temp', 'xl_');
copy($filetplpath,$tmppath);

/*open tempfile, import the csv file, and set pivots to refresh*/
$xl=new xlsx($tmppath);
$xl->importcsv($csvtosheet,$csvpath1,$csvdelimiter,$csvenclosure,$csvtocol,$csvtorow);
$xl->refreshPivotsOnOpen ();
$xl->close();

/*output tempfile*/
header('Content-Disposition: attachment;filename="'.$fileexportname.'"');
ob_clean();   
readfile($tmppath);
exit;
?>
